<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏</a>
        <a href="/orders" class="btn btn-outline-light">–ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
    </div>
</nav>

<div class="container mt-4">
    <h1 class="mb-4">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑ ‚Ññ<span th:text="${order.orderNumber}"></span></h1>

    <form th:action="@{/orders/update/{id}(id=${order.orderNumber})}" method="post">
        <!-- –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ) -->
        <div class="mb-3">
            <label class="form-label">–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞</label>
            <input type="text" class="form-control"
                   th:value="${order.orderNumber}" readonly>
        </div>

        <!-- –í—ã–±–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–∞ -->
        <div class="mb-3">
            <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç *</label>
            <select class="form-select" name="selectedProductName" required
                    id="productSelect" onchange="updateProductInfo()">
                <option th:each="product : ${allProducts}"
                        th:value="${product.name}"
                        th:text="${product.name}"
                        th:data-price="${product.currentPrice}"
                        th:data-stock="${product.stockStatus}"
                        th:selected="${product.name == order.productName}">
                </option>
            </select>
            <div class="mt-2">
                <small>
                    –¶–µ–Ω–∞: <span id="productPrice">-</span> ‚ÇΩ |
                    –ù–∞–ª–∏—á–∏–µ: <span id="productStock">-</span>
                </small>
            </div>
        </div>

        <!-- –í—ã–±–æ—Ä –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è -->
        <div class="mb-3">
            <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ *</label>
            <select class="form-select" name="selectedEnterpriseName" required>
                <option th:each="enterprise : ${allEnterprises}"
                        th:value="${enterprise.name}"
                        th:text="${enterprise.name + ' (–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å: ' + enterprise.directorName + ')'}"
                        th:selected="${enterprise.name == order.enterpriseName}">
                </option>
            </select>
        </div>

        <!-- –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ -->
        <div class="mb-3">
            <label class="form-label">–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ *</label>
            <select class="form-select" name="orderStatus" required>
                <option value="PENDING" th:selected="${order.orderStatus == 'PENDING'}">üü° –í –æ–∂–∏–¥–∞–Ω–∏–∏</option>
                <option value="PROCESSING" th:selected="${order.orderStatus == 'PROCESSING'}">üîÑ –í –æ–±—Ä–∞–±–æ—Ç–∫–µ</option>
                <option value="COMPLETED" th:selected="${order.orderStatus == 'COMPLETED'}">‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω</option>
                <option value="CANCELLED" th:selected="${order.orderStatus == 'CANCELLED'}">‚ùå –û—Ç–º–µ–Ω–µ–Ω</option>
            </select>
        </div>

        <!-- –¶–µ–Ω–∞ -->
        <div class="mb-3">
            <label class="form-label">–¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É *</label>
            <div class="input-group">
                <input type="number" step="0.01" class="form-control"
                       name="currentPriceInOrder" id="priceInput" required
                       th:value="${order.currentPriceInOrder}">
                <span class="input-group-text">‚ÇΩ</span>
            </div>
            <small class="text-muted">–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞: <span id="currentProductPrice">-</span> ‚ÇΩ</small>
        </div>

        <!-- –î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞ -->
        <div class="mb-3">
            <label class="form-label">–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞ *</label>
            <input type="date" class="form-control" name="orderDate"
                   th:value="${#temporals.format(order.orderDate, 'yyyy-MM-dd')}" required>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ -->
        <div class="mb-3">
            <button type="submit" class="btn btn-warning">–û–±–Ω–æ–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
            <a href="/orders" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
        </div>
    </form>
</div>

<script>
    function updateProductInfo() {
        const select = document.getElementById('productSelect');
        const selectedOption = select.options[select.selectedIndex];

        if (selectedOption.value) {
            const price = parseFloat(selectedOption.dataset.price).toFixed(2);

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ü–µ–Ω–µ –ø—Ä–æ–¥—É–∫—Ç–∞
            document.getElementById('currentProductPrice').textContent = price;
            document.getElementById('productPrice').textContent = price;

            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç–∞—Ç—É—Å
            const stock = selectedOption.dataset.stock;
            let stockText = '';
            switch(stock) {
                case 'IN_STOCK': stockText = '‚úÖ –í –Ω–∞–ª–∏—á–∏–∏'; break;
                case 'LOW_STOCK': stockText = '‚ö†Ô∏è –ú–∞–ª–æ –æ—Å—Ç–∞–ª–æ—Å—å'; break;
                case 'OUT_OF_STOCK': stockText = '‚ùå –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'; break;
                default: stockText = stock;
            }
            document.getElementById('productStock').textContent = stockText;
        }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener('DOMContentLoaded', function() {
        updateProductInfo();
    });
</script>
</body>
</html>
</body>
</html>